<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>ุชูุงุตูู ุงููุณุงุฑุฉ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/modern-theme.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/crusher-details.css">
</head>

<body>
    <div id="sidebar-placeholder"></div>

    <div class="main-content">
        <div class="page-header">
            <div class="page-header-flex">
                <h1 class="page-title" id="crusherName">ุชูุงุตูู ุงููุณุงุฑุฉ</h1>
                <button class="btn btn-secondary" id="editCrusherBtn">
                    โ๏ธ ุชุนุฏูู ุงูุจูุงูุงุช
                </button>
            </div>
        </div>

        <!-- Edit Crusher Modal -->
        <div id="editCrusherModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ุชุนุฏูู ุจูุงูุงุช ุงููุณุงุฑุฉ</h2>
                    <button class="modal-close" data-action="close-modal"
                        data-target="editCrusherModal">&times;</button>
                </div>
                <form id="editCrusherForm">
                    <div class="form-group">
                        <label for="editCrusherName">ุงุณู ุงููุณุงุฑุฉ *</label>
                        <input type="text" id="editCrusherName" name="name" autocomplete="organization" required>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" data-action="close-modal"
                            data-target="editCrusherModal">ุฅูุบุงุก</button>
                        <button type="submit" class="btn btn-primary">ุญูุธ ุงูุชุนุฏููุงุช</button>
                    </div>
                    <div id="editCrusherMessage"></div>
                </form>
            </div>
        </div>

        <div class="summary-card" id="summaryCard">
            <h2 class="text-xl font-semibold mb-4">ุงูููุฎุต ุงููุงูู</h2>
            <div class="summary-grid" id="summaryGrid">
                <div class="loading">ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...</div>
            </div>
        </div>

        <!-- Material Prices Section -->
        <div class="section">
            <div class="section-header">
                <h3 class="section-title">ุฃุณุนุงุฑ ุงูููุงุฏ</h3>
                <button class="btn btn-primary" id="editPricesBtn">โ๏ธ ุชุนุฏูู ุงูุฃุณุนุงุฑ</button>
            </div>
            <div class="section-content">
                <div class="warning-box">
                    <div class="warning-icon">โ๏ธ</div>
                    <div class="warning-text">
                        <strong>ุชูุจูู:</strong> ูุฐู ุงูุฃุณุนุงุฑ ุณุชูุณุชุฎุฏู ููุชุณูููุงุช ุงูุฌุฏูุฏุฉ ููุท. ุงูุชุณูููุงุช ุงูุณุงุจูุฉ ุชุญุชูุธ
                        ุจุฃุณุนุงุฑูุง ุงูุชุงุฑูุฎูุฉ.
                    </div>
                </div>
                <div class="prices-display-grid" id="pricesDisplayGrid">
                    <div class="loading">ุฌุงุฑู ุชุญููู ุงูุฃุณุนุงุฑ...</div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <h3 class="section-title">ููุฎุต ุงูููุงุฏ</h3>
            </div>
            <div class="section-content">
                <div class="materials-grid" id="materialsContainer">
                    <div class="loading">ุฌุงุฑู ุชุญููู ุงูููุงุฏ...</div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <h3 class="section-title">ุงูุชุณูููุงุช</h3>
            </div>
            <div class="section-content">
                <div class="controls">
                    <input type="text" class="form-input search-input" id="deliveriesSearch"
                        placeholder="ุงุจุญุซ ูู ุงูุชุณูููุงุช..." autocomplete="off">
                    <input type="date" class="form-input" id="deliveriesDateFrom" placeholder="ูู ุชุงุฑูุฎ"
                        autocomplete="off">
                    <input type="date" class="form-input" id="deliveriesDateTo" placeholder="ุฅูู ุชุงุฑูุฎ"
                        autocomplete="off">
                    <select class="form-select" id="deliveriesSort">
                        <option value="date-desc">ุงูุฃุญุฏุซ ุฃููุงู</option>
                        <option value="date-asc">ุงูุฃูุฏู ุฃููุงู</option>
                        <option value="value-desc">ุงูุฃุนูู ูููุฉ</option>
                        <option value="value-asc">ุงูุฃูู ูููุฉ</option>
                    </select>
                </div>
                <div class="table-container" id="deliveriesContainer">
                    <div class="loading">ุฌุงุฑู ุชุญููู ุงูุชุณูููุงุช...</div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <h3 class="section-title">ุงูุชุณููุงุช ูุงููุณุชุญูุงุช</h3>
                <button class="btn btn-primary" id="addAdjustmentBtn">+ ุฅุถุงูุฉ ุชุณููุฉ</button>
            </div>
            <div class="section-content">
                <div class="settlement-summary">
                    <div class="settlement-grid" id="settlementSummary">
                        <div class="loading">ุฌุงุฑู ุชุญููู ููุฎุต ุงูุชุณููุงุช...</div>
                    </div>
                </div>
                <div class="controls">
                    <input type="text" class="form-input search-input" id="adjustmentsSearch"
                        placeholder="ุงุจุญุซ ูู ุงูุชุณููุงุช...">
                    <input type="date" class="form-input" id="adjustmentsDateFrom" placeholder="ูู ุชุงุฑูุฎ">
                    <input type="date" class="form-input" id="adjustmentsDateTo" placeholder="ุฅูู ุชุงุฑูุฎ">
                    <select class="form-select" id="adjustmentsSort">
                        <option value="date-desc">ุงูุฃุญุฏุซ ุฃููุงู</option>
                        <option value="date-asc">ุงูุฃูุฏู ุฃููุงู</option>
                        <option value="amount-desc">ุงูุฃุนูู ูุจูุบ</option>
                        <option value="amount-asc">ุงูุฃูู ูุจูุบ</option>
                    </select>
                </div>
                <div class="table-container" id="adjustmentsContainer">
                    <div class="loading">ุฌุงุฑู ุชุญููู ุงูุชุณููุงุช...</div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <h3 class="section-title">ุงููุฏููุนุงุช</h3>
                <button class="btn btn-primary" id="addPaymentBtn">+ ุฅุถุงูุฉ ุฏูุนุฉ</button>
            </div>
            <div class="section-content">
                <div class="controls">
                    <input type="text" class="form-input search-input" id="paymentsSearch"
                        placeholder="ุงุจุญุซ ูู ุงููุฏููุนุงุช...">
                    <input type="date" class="form-input" id="paymentsDateFrom" placeholder="ูู ุชุงุฑูุฎ">
                    <input type="date" class="form-input" id="paymentsDateTo" placeholder="ุฅูู ุชุงุฑูุฎ">
                    <select class="form-select" id="paymentsSort">
                        <option value="date-desc">ุงูุฃุญุฏุซ ุฃููุงู</option>
                        <option value="date-asc">ุงูุฃูุฏู ุฃููุงู</option>
                        <option value="amount-desc">ุงูุฃุนูู ูุจูุบ</option>
                        <option value="amount-asc">ุงูุฃูู ูุจูุบ</option>
                    </select>
                </div>
                <div class="table-container" id="paymentsContainer">
                    <div class="loading">ุฌุงุฑู ุชุญููู ุงููุฏููุนุงุช...</div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <h3 class="section-title">ุงูุชูุงุฑูุฑ ููุดูู ุงูุญุณุงุจ</h3>
            </div>
            <div class="section-content">
                <div class="reports-grid">
                    <div class="report-card">
                        <h4>ุชูุฑูุฑ ุงูุชูุฑูุฏุงุช</h4>
                        <p>ุชูุฑูุฑ ููุตู ุจุงููููุงุช ุงูููุฑุฏู ุญุณุจ ููุน ุงููุงุฏุฉ</p>

                        <div class="date-inputs-row">
                            <input type="date" id="deliveriesFromDate" class="form-input" placeholder="ูู ุชุงุฑูุฎ">
                            <input type="date" id="deliveriesToDate" class="form-input" placeholder="ุฅูู ุชุงุฑูุฎ">
                        </div>
                        <button id="generateDeliveriesReportBtn" class="btn">
                            ๐ ุฅูุดุงุก ุชูุฑูุฑ ุงูุชูุฑูุฏุงุช
                        </button>
                    </div>

                    <div class="report-card success">
                        <h4>ูุดู ุญุณุงุจ ุงููุณุงุฑุฉ</h4>
                        <p>ูุดู ุญุณุงุจ ุดุงูู ุจุงูุชูุฑูุฏุงุช ูุงููุฏููุนุงุช ูุงูุฑุตูุฏ</p>

                        <div class="checkbox-container">
                            <label>
                                <input type="checkbox" id="useCustomDateRange" onchange="toggleDateInputs()">
                                ุงุณุชุฎุฏุงู ูุชุฑุฉ ุฒูููุฉ ูุญุฏุฏุฉ
                            </label>
                            <div id="dateInputs" class="hidden">
                                <input type="date" id="statementFromDate" class="form-input" placeholder="ูู ุชุงุฑูุฎ">
                                <input type="date" id="statementToDate" class="form-input" placeholder="ุฅูู ุชุงุฑูุฎ">
                            </div>
                        </div>

                        <button id="generateAccountStatementBtn" class="btn">
                            ๐ ุฅูุดุงุก ูุดู ุงูุญุณุงุจ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Prices Modal -->
    <div class="modal" id="editPricesModal">
        <div class="modal-content">
            <div class="modal-header">ุชุนุฏูู ุฃุณุนุงุฑ ุงูููุงุฏ</div>
            <div class="warning-box">
                <div class="warning-icon">โ๏ธ</div>
                <div class="warning-text">
                    <strong>ุชูุจูู ููู:</strong> ุชุนุฏูู ุงูุฃุณุนุงุฑ ุณูุคุซุฑ ููุท ุนูู ุงูุชุณูููุงุช ุงูุฌุฏูุฏุฉ.
                    ุฌููุน ุงูุชุณูููุงุช ุงูุณุงุจูุฉ ุณุชุญุชูุธ ุจุงูุฃุณุนุงุฑ ุงูุชุงุฑูุฎูุฉ ุงููุญููุธุฉ ููุช ุฅูุดุงุฆูุง.
                </div>
            </div>
            <div id="editPricesMessage"></div>
            <form id="editPricesForm">
                <div class="prices-edit-grid">
                    <div class="form-group">
                        <label class="form-label" for="editSandPrice">ุฑูู (ุฌููู/ูยณ)</label>
                        <input type="number" class="form-input" id="editSandPrice" step="0.01" min="0"
                            placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editAggregate1Price">ุณู 1 (ุฌููู/ูยณ)</label>
                        <input type="number" class="form-input" id="editAggregate1Price" step="0.01" min="0"
                            placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editAggregate2Price">ุณู 2 (ุฌููู/ูยณ)</label>
                        <input type="number" class="form-input" id="editAggregate2Price" step="0.01" min="0"
                            placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editAggregate3Price">ุณู 3 (ุฌููู/ูยณ)</label>
                        <input type="number" class="form-input" id="editAggregate3Price" step="0.01" min="0"
                            placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editAggregate6PowderPrice">ุณู 6 ุจูุฏุฑุฉ (ุฌููู/ูยณ)</label>
                        <input type="number" class="form-input" id="editAggregate6PowderPrice" step="0.01" min="0"
                            placeholder="0.00">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" data-action="close-modal"
                        data-target="editPricesModal">ุฅูุบุงุก</button>
                    <button type="submit" class="btn btn-primary">ุญูุธ ุงูุชุนุฏููุงุช</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <div class="modal-header">ุฅุถุงูุฉ ุฏูุนุฉ ุฌุฏูุฏุฉ</div>
            <div id="paymentMessage"></div>
            <form id="paymentForm">
                <div class="form-group">
                    <label class="form-label" for="paymentAmount">ุงููุจูุบ *</label>
                    <input type="number" class="form-input" id="paymentAmount" required min="0" step="0.01"
                        autocomplete="transaction-amount">
                </div>
                <div class="form-group">
                    <label class="form-label" for="paymentMethod">ุทุฑููุฉ ุงูุฏูุน *</label>
                    <select class="form-select" id="paymentMethod" required>
                        <option value="">ุงุฎุชุฑ ุทุฑููุฉ ุงูุฏูุน</option>
                        <option value="ููุฏู">ููุฏู</option>
                        <option value="ุจููู">ุจููู</option>
                        <option value="ุดูู">ุดูู</option>
                        <option value="ุงูุณุชุงุจุงู">ุงูุณุชุงุจุงู</option>
                        <option value="ููุฏุงููู ูุงุด">ููุฏุงููู ูุงุด</option>
                    </select>
                </div>
                <div class="form-group hidden" id="paymentDetailsGroup">
                    <label class="form-label" for="paymentDetails">ุฑูู ุงููุนุงููุฉ / ุฑูู ุงูุดูู</label>
                    <input type="text" class="form-input" id="paymentDetails"
                        placeholder="ุฃุฏุฎู ุฑูู ุงููุนุงููุฉ ุฃู ุฑูู ุงูุดูู" autocomplete="off">
                </div>
                <div class="form-group hidden" id="paymentImageGroup">
                    <label class="form-label" for="paymentImage">ุตูุฑุฉ ุงูุฏูุน</label>
                    <input type="file" class="form-input" id="paymentImage" accept="image/*">
                    <small class="form-help">ุงุฑูุน ุตูุฑุฉ ุงูุฅูุตุงู ุฃู ุงูุดูู ุฃู ุงููุนุงููุฉ ุงูุจูููุฉ</small>
                    <div id="paymentImagePreview"></div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="paymentDate">ุงูุชุงุฑูุฎ</label>
                    <input type="date" class="form-input" id="paymentDate" autocomplete="off">
                </div>
                <div class="form-group">
                    <label class="form-label" for="paymentNote">ููุงุญุธุงุช</label>
                    <textarea class="form-textarea" id="paymentNote"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" data-action="close-modal"
                        data-target="paymentModal">ุฅูุบุงุก</button>
                    <button type="submit" class="btn btn-primary">ุฅุถุงูุฉ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Adjustment Modal -->
    <div class="modal" id="adjustmentModal">
        <div class="modal-content">
            <div class="modal-header">ุฅุถุงูุฉ ุชุณููุฉ ุฌุฏูุฏุฉ</div>
            <div id="adjustmentMessage"></div>
            <form id="adjustmentForm">
                <div class="form-group">
                    <label class="form-label" for="adjustmentAmount">ุงููุจูุบ *</label>
                    <input type="number" class="form-input" id="adjustmentAmount" required step="0.01">
                    <small class="text-gray-500">ููุฌุจ: ูุถุงู ูููุณุชุญูุงุช | ุณุงูุจ: ูุฎุตู ูู ุงููุณุชุญูุงุช</small>
                </div>
                <div class="form-group">
                    <label class="form-label" for="adjustmentMethod">ุทุฑููุฉ ุงูุชุณููุฉ</label>
                    <select class="form-select" id="adjustmentMethod">
                        <option value="">ุงุฎุชุฑ ุทุฑููุฉ ุงูุชุณููุฉ</option>
                        <option value="ููุฏู">ููุฏู</option>
                        <option value="ุจููู">ุจููู</option>
                        <option value="ุดูู">ุดูู</option>
                        <option value="ุงูุณุชุงุจุงู">ุงูุณุชุงุจุงู</option>
                        <option value="ููุฏุงููู ูุงุด">ููุฏุงููู ูุงุด</option>
                        <option value="ุชุนุฏูู ุญุณุงุจู">ุชุนุฏูู ุญุณุงุจู</option>
                    </select>
                </div>
                <div class="form-group hidden" id="adjustmentDetailsGroup">
                    <label class="form-label" for="adjustmentDetails">ุฑูู ุงููุนุงููุฉ / ุฑูู ุงูุดูู</label>
                    <input type="text" class="form-input" id="adjustmentDetails"
                        placeholder="ุฃุฏุฎู ุฑูู ุงููุนุงููุฉ ุฃู ุฑูู ุงูุดูู">
                </div>
                <div class="form-group">
                    <label class="form-label" for="adjustmentReason">ุงูุณุจุจ</label>
                    <textarea class="form-textarea" id="adjustmentReason" placeholder="ุณุจุจ ุงูุชุณููุฉ..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" data-action="close-modal"
                        data-target="adjustmentModal">ุฅูุบุงุก</button>
                    <button type="submit" class="btn btn-primary">ุฅุถุงูุฉ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delivery Edit Modal -->
    <div class="modal" id="deliveryEditModal">
        <div class="modal-content">
            <div class="modal-header">ุชุนุฏูู ุงูุชุณููู</div>
            <div id="deliveryEditMessage"></div>
            <form id="deliveryEditForm">
                <div class="form-group">
                    <label class="form-label" for="editDeliveryMaterial">ุงููุงุฏุฉ *</label>
                    <select class="form-select" id="editDeliveryMaterial" required>
                        <option value="">ุงุฎุชุฑ ุงููุงุฏุฉ</option>
                        <option value="ุฑูู">ุฑูู</option>
                        <option value="ุณู 1">ุณู 1</option>
                        <option value="ุณู 2">ุณู 2</option>
                        <option value="ุณู 3">ุณู 3</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editDeliveryVoucher">ุฑูู ุงูุจูู</label>
                    <input type="text" class="form-input" id="editDeliveryVoucher" placeholder="ุฑูู ุงูุจูู">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editDeliveryCarVolume">ุชูุนูุจ ุงูุณูุงุฑุฉ (ูยณ) *</label>
                    <input type="number" class="form-input" id="editDeliveryCarVolume" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editDeliveryDiscountVolume">ูููุฉ ุงูุฎุตู (ูยณ)</label>
                    <input type="number" class="form-input" id="editDeliveryDiscountVolume" min="0" step="0.01"
                        value="0">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editDeliveryDriverName">ุงุณู ุงูุณุงุฆู</label>
                    <input type="text" class="form-input" id="editDeliveryDriverName" placeholder="ุงุณู ุงูุณุงุฆู">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editDeliveryCarHead">ุฑูู ุงูุฑุฃุณ</label>
                    <input type="text" class="form-input" id="editDeliveryCarHead" placeholder="ุฑูู ุฑุฃุณ ุงูุณูุงุฑุฉ">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editDeliveryCarTail">ุฑูู ุงูููุทูุฑุฉ</label>
                    <input type="text" class="form-input" id="editDeliveryCarTail" placeholder="ุฑูู ุงูููุทูุฑุฉ">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editDeliveryContractorCharge">ูุณุชุญู ุงูููุงูู ููู ูุชุฑ</label>
                    <input type="number" class="form-input" id="editDeliveryContractorCharge" min="0" step="0.01">
                </div>
                <div class="warning-box" style="margin: 15px 0;">
                    <div class="warning-icon">โ๏ธ</div>
                    <div>
                        <strong>ุชูุจูู:</strong> ูู ูุชู ุชุนุฏูู ุงูุณุนุฑ ุงูุชุงุฑูุฎู ูููุงุฏุฉ ููุญูุงุธ ุนูู ุฏูุฉ ุงูุญุณุงุจุงุช ุงููุญุงุณุจูุฉ.
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" data-action="close-modal"
                        data-target="deliveryEditModal">ุฅูุบุงุก</button>
                    <button type="submit" class="btn btn-primary">ุญูุธ ุงูุชุนุฏูู</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Payment Details Modal -->
    <div class="modal" id="paymentDetailsModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <span>ุชูุงุตูู ุงูุฏูุนุฉ</span>
                <button class="modal-close" data-action="close-modal" data-target="paymentDetailsModal">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <div id="paymentDetailsContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" data-action="close-modal"
                    data-target="paymentDetailsModal">ุฅุบูุงู</button>
            </div>
        </div>
    </div>

    <!-- Adjustment Details Modal -->
    <div class="modal" id="adjustmentDetailsModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <span>ุชูุงุตูู ุงูุชุณููุฉ</span>
                <button class="modal-close" data-action="close-modal"
                    data-target="adjustmentDetailsModal">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <div id="adjustmentDetailsContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" data-action="close-modal"
                    data-target="adjustmentDetailsModal">ุฅุบูุงู</button>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="modal" id="imageModal">
        <div class="modal-content large">
            <div class="modal-header">
                <span>ุนุฑุถ ุงูุตูุฑุฉ</span>
                <button class="modal-close" data-action="close-modal" data-target="imageModal">&times;</button>
            </div>
            <div class="modal-body">
                <img id="modalImage" alt="ุตูุฑุฉ ุงูุฏูุน">
            </div>
        </div>
    </div>

    <script src="js/csp-fix.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/sidebar.js"></script>
    <script src="js/crusher-details.js"></script>
</body>

</html>
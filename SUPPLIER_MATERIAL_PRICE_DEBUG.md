# تصحيح مشكلة سعر المادة للموردين
# Supplier Material Price Debugging Guide

## المشكلة / Problem
عند إنشاء إدخال جديد مع مورد، تظهر رسالة خطأ "سعر المادة غير محدد في المورد المختار" حتى عندما يكون السعر محددًا.

When creating a new entry with a supplier, the error message "Material price is not set for the selected supplier" appears even when the price is set.

## التحسينات المطبقة / Applied Improvements

### 1. تحسين دالة `getSupplierPriceByMaterial`
تم إضافة سجلات تصحيح مفصلة لتتبع المشكلة:
- التحقق من وجود المورد
- التحقق من وجود مصفوفة المواد
- التحقق من تطابق اسم المادة
- عرض المواد المتاحة في حالة عدم العثور على المادة

### 2. تحسين رسائل الخطأ
الآن تعرض رسالة الخطأ:
- اسم المادة المحددة
- اسم المورد/الكسارة
- معلومات أكثر تفصيلاً لتحديد المشكلة

### 3. تحسين عرض السعر
تم تحسين دالة `updateCrusherPrice` لعرض:
- اسم المادة في رسالة السعر
- اسم المورد/الكسارة في رسالة الخطأ

## خطوات التصحيح / Debugging Steps

### الخطوة 1: فتح أدوات المطور
1. افتح صفحة الإدخال الجديد
2. اضغط F12 لفتح أدوات المطور
3. انتقل إلى تبويب Console

### الخطوة 2: اختبار المورد
1. اختر مورد من القائمة
2. اختر مادة من القائمة
3. راقب الرسائل في Console

### الخطوة 3: تحليل الرسائل

#### إذا ظهرت رسالة "Supplier has no materials"
**المشكلة:** المورد ليس لديه مواد محددة
**الحل:**
1. اذهب إلى صفحة تفاصيل المورد
2. أضف المواد والأسعار
3. احفظ التغييرات
4. حدّث صفحة الإدخال الجديد

#### إذا ظهرت رسالة "Material not found in supplier"
**المشكلة:** اسم المادة المختارة لا يطابق المواد المحفوظة للمورد
**الحل:**
1. تحقق من الرسالة التي تعرض "Available materials"
2. قارن اسم المادة المختارة مع الأسماء المتاحة
3. تأكد من التطابق التام (بما في ذلك المسافات والأحرف)
4. إذا كانت الأسماء مختلفة، قم بتحديث المواد في صفحة المورد

#### إذا ظهرت رسالة "Found supplier material price: [material] 0"
**المشكلة:** السعر محفوظ بقيمة 0
**الحل:**
1. اذهب إلى صفحة تفاصيل المورد
2. عدّل المادة وأدخل السعر الصحيح
3. احفظ التغييرات
4. حدّث صفحة الإدخال الجديد

### الخطوة 4: التحقق من البيانات المحفوظة

افتح Console واكتب:
```javascript
// عرض جميع الموردين والمواد الخاصة بهم
suppliersData.forEach(s => {
    console.log('Supplier:', s.name);
    console.log('Materials:', s.materials);
});
```

## الأسباب المحتملة / Possible Causes

1. **المورد ليس لديه مواد محددة**
   - الحل: أضف المواد في صفحة تفاصيل المورد

2. **عدم تطابق أسماء المواد**
   - الحل: تأكد من أن اسم المادة في القائمة المنسدلة يطابق تمامًا الاسم المحفوظ

3. **السعر محفوظ بقيمة 0 أو null**
   - الحل: عدّل المادة وأدخل السعر الصحيح

4. **البيانات لم يتم تحميلها بشكل صحيح**
   - الحل: اضغط على زر التحديث في الصفحة

5. **مشكلة في تنسيق البيانات من API**
   - الحل: تحقق من استجابة API في تبويب Network

## اختبار سريع / Quick Test

في Console، اكتب:
```javascript
// اختبار دالة الحصول على السعر
const testSupplierId = 'SUPPLIER_ID_HERE'; // ضع معرف المورد
const testMaterial = 'اسم المادة'; // ضع اسم المادة
const price = getSupplierPriceByMaterial(testSupplierId, testMaterial);
console.log('Price:', price);
```

## ملاحظات إضافية / Additional Notes

- تأكد من حفظ المواد والأسعار في صفحة المورد قبل إنشاء إدخال جديد
- استخدم زر التحديث في صفحة الإدخال الجديد لإعادة تحميل البيانات
- الآن ستظهر رسائل تصحيح مفصلة في Console لمساعدتك في تحديد المشكلة بدقة
